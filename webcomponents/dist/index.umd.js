!function(){"use strict";try{if("undefined"!=typeof document){var o=document.createElement("style");o.appendChild(document.createTextNode(":root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}body{margin:0;display:flex;place-items:center;min-width:320px;min-height:100vh}h1{font-size:3.2em;line-height:1.1}button{border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:border-color .25s}button:hover{border-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}")),document.head.appendChild(o)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}();
!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=Object.defineProperty,e=(e,i,n)=>(((e,i,n)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n})(e,"symbol"!=typeof i?i+"":i,n),n);const i=(t,e)=>{const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},n=t=>t*(Math.PI/180),o=t=>t*(180/Math.PI),s=new Map,r=t=>{s.has(t)&&clearTimeout(s.get(t)),s.set(t,setTimeout(t,100))},a=(t,e,i)=>{const n=e.split(/[ ,]+/g);let o;for(let s=0;s<n.length;s+=1)o=n[s],t.addEventListener?t.addEventListener(o,i,!1):t.attachEvent&&t.attachEvent(o,i)},d=(t,e,i)=>{const n=e.split(/[ ,]+/g);let o;for(let s=0;s<n.length;s+=1)o=n[s],t.removeEventListener?t.removeEventListener(o,i):t.detachEvent&&t.detachEvent(o,i)},c=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),p=()=>({x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}),l=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},h=(t,e,i)=>{const n=u(t);for(let o in n)if(n.hasOwnProperty(o))if("string"==typeof e)n[o]=e+" "+i;else{let t="";for(let n=0,o=e.length;n<o;n+=1)t+=e[n]+" "+i+", ";n[o]=t.slice(0,-2)}return n},u=t=>{const e={};e[t]="";return["webkit","Moz","o"].forEach((function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""})),e},f=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},m=(t,e)=>{if(t.length)for(let i=0,n=t.length;i<n;i+=1)e(t[i]);else e(t)};var y,g=!!("ontouchstart"in window),v=!!window.PointerEvent,b=!!window.MSPointerEvent,x={start:"mousedown",move:"mousemove",end:"mouseup"},w={};function O(){}function k(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=k.id,k.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function _(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=_.id,_.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),"static"!==i.options.mode&&"semi"!==i.options.mode||(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&"flex"===n.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}function T(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=p(),e.config(t),e.prepareCollections();var i=function(){var t;e.collections.forEach((function(i){i.forEach((function(i){t=i.el.getBoundingClientRect(),i.position={x:e.scroll.x+t.left,y:e.scroll.y+t.top}}))}))};a(window,"resize",(function(){r(i)}));var n=function(){e.scroll=p()};return a(window,"scroll",(function(){r(n)})),e.collections}v?y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:b?y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:g?(y={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},w=x):y=x,O.prototype.on=function(t,e){var i,n=this,o=t.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<o.length;s+=1)i=o[s],n._handlers_[i]=n._handlers_[i]||[],n._handlers_[i].push(e);return n},O.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},void 0===t?i._handlers_={}:void 0===e?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i},O.prototype.trigger=function(t,e){var i,n=this,o=t.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<o.length;s+=1)i=o[s],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach((function(t){t.call(n,{type:i,target:n},e)}))},O.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=((t,e)=>{const i={};for(let n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:t.hasOwnProperty(n)&&(i[n]=t[n]);return i})(e.options,t))},O.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){"function"==typeof i["on"+e]?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},a(t,y[e],i._domHandlers_[e]),w[e]&&a(t,w[e],i._domHandlers_[e]),i},O.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},d(t,y[e],i._domHandlers_[e]),w[e]&&d(t,w[e],i._domHandlers_[e]),delete i._domHandlers_[e],this},k.prototype=new O,k.constructor=k,k.id=0,k.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},k.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=((t,e)=>{const i=u(t);for(let n in i)i.hasOwnProperty(n)&&(i[n]=e);return i})("borderRadius","50%"),i=h("transition","opacity",t),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},f(n.el,i),"circle"===this.options.shape&&f(n.back,e),f(n.front,e),this.applyStyles(n),this},k.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this},k.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},k.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},k.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},k.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout((function(){e.ui.el.style.opacity=1}),0),e.showTimeout=setTimeout((function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)}),e.options.fadeTime)),e},k.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout((function(){var i="dynamic"===e.options.mode?"none":"block";e.ui.el.style.display=i,"function"==typeof t&&t.call(e),e.trigger("hidden",e.instance)}),e.options.fadeTime),e.options.restJoystick){const i=e.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:e.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:e.instance.frontPosition.y,e.setPosition(t,n)}return e},k.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",o={};o.front=h("transition",["transform"],n);var s={front:{}};s.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(o),i.applyStyles(s),i.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(i),i.restCallback()}),i.options.fadeTime)},k.prototype.restCallback=function(){var t=this,e={};e.front=h("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)},k.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},k.prototype.computeDirection=function(t){var e,i,n,o=t.angle.radian,s=Math.PI/4,r=Math.PI/2;if(o>s&&o<3*s&&!t.lockX?e="up":o>-s&&o<=s&&!t.lockY?e="left":o>3*-s&&o<=-s&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(i=o>-r&&o<r?"left":"right"),t.lockX||(n=o>0?"up":"down"),t.force>this.options.threshold){var a,d={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(d[a]=this.direction[a]);var c={};for(a in this.direction={x:i,y:n,angle:e},t.direction=this.direction,d)d[a]===this.direction[a]&&(c[a]=!0);if(c.x&&c.y&&c.angle)return t;c.x&&c.y||this.trigger("plain",t),c.x||this.trigger("plain:"+i,t),c.y||this.trigger("plain:"+n,t),c.angle||this.trigger("dir dir:"+e,t)}else this.resetDirection();return t},_.prototype=new O,_.constructor=_,_.id=0,_.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(t){if(void 0===t)return e[0];for(var i=0,n=e.length;i<n;i+=1)if(e[i].identifier===t)return e[i];return!1}},_.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},_.prototype.begin=function(){var t=this,e=t.options;if("static"===e.mode){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}},_.prototype.createNipple=function(t,e){var i=this,n=i.manager.scroll,o={},s=i.options,r=i.parentIsFlex?n.x:n.x+i.box.left,a=i.parentIsFlex?n.y:n.y+i.box.top;if(t.x&&t.y)o={x:t.x-r,y:t.y-a};else if(t.top||t.right||t.bottom||t.left){var d=document.createElement("DIV");d.style.display="hidden",d.style.top=t.top,d.style.right=t.right,d.style.bottom=t.bottom,d.style.left=t.left,d.style.position="absolute",s.zone.appendChild(d);var c=d.getBoundingClientRect();s.zone.removeChild(d),o=t,t={x:c.left+n.x,y:c.top+n.y}}var p=new k(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:t,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(l(p.ui.el,o),l(p.ui.front,p.frontPosition)),i.nipples.push(p),i.trigger("added "+p.identifier+":added",p),i.manager.trigger("added "+p.identifier+":added",p),i.bindNipple(p),p},_.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},_.prototype.bindNipple=function(t){var e,i=this,n=function(t,n){e=t.type+" "+n.id+":"+t.type,i.trigger(e,n)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)},_.prototype.pressureFn=function(t,e,i){var n=this,o=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var i=t.force||t.pressure||t.webkitForce||0;i!==o&&(e.trigger("pressure",i),n.trigger("pressure "+e.identifier+":pressure",i),o=i)}.bind(n),100)},_.prototype.onstart=function(t){var e=this,i=e.options,n=t;t=c(t),e.updateBox();return m(t,(function(o){e.actives.length<i.maxNumberOfNipples?e.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach((function(i){if(Object.values(n.touches).findIndex((function(t){return t.identifier===i}))<0){var o=[t[0]];o.identifier=i,e.processOnEnd(o)}})),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(o))})),e.manager.bindDocument(),!1},_.prototype.processOnStart=function(t){var e,n=this,o=n.options,s=n.manager.getIdentifier(t),r=t.force||t.pressure||t.webkitForce||0,a={x:t.pageX,y:t.pageY},d=n.getOrCreate(s,a);d.identifier!==s&&n.manager.removeIdentifier(d.identifier),d.identifier=s;var c=function(e){e.trigger("start",e),n.trigger("start "+e.id+":start",e),e.show(),r>0&&n.pressureFn(t,e,e.identifier),n.processOnMove(t)};if((e=n.idles.indexOf(d))>=0&&n.idles.splice(e,1),n.actives.push(d),n.ids.push(d.identifier),"semi"!==o.mode)c(d);else{if(!(i(a,d.position)<=o.catchDistance))return d.destroy(),void n.processOnStart(t);c(d)}return d},_.prototype.getOrCreate=function(t,e){var i,n=this,o=n.options;return/(semi|static)/.test(o.mode)?(i=n.idles[0])?(n.idles.splice(0,1),i):"semi"===o.mode?n.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):i=n.createNipple(e,t)},_.prototype.processOnMove=function(t){var e=this,s=e.options,r=e.manager.getIdentifier(t),a=e.nipples.get(r),d=e.manager.scroll;if((t=>isNaN(t.buttons)?0!==t.pressure:0!==t.buttons)(t)){if(!a)return console.error("Found zombie joystick with ID "+r),void e.manager.removeIdentifier(r);if(s.dynamicPage){var c=a.el.getBoundingClientRect();a.position={x:d.x+c.left,y:d.y+c.top}}a.identifier=r;var p=a.options.size/2,l={x:t.pageX,y:t.pageY};s.lockX&&(l.y=a.position.y),s.lockY&&(l.x=a.position.x);var h,u,f=i(l,a.position),m=((t,e)=>{const i=e.x-t.x,n=e.y-t.y;return o(Math.atan2(n,i))})(l,a.position),y=n(m),g=f/p,v={distance:f,position:l};if("circle"===a.options.shape?(h=Math.min(f,p),u=((t,e,i)=>{const o={x:0,y:0};return i=n(i),o.x=t.x-e*Math.cos(i),o.y=t.y-e*Math.sin(i),o})(a.position,h,m)):(u=((t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)}))(l,a.position,p),h=i(u,a.position)),s.follow){if(f>p){let t=l.x-u.x,n=l.y-u.y;a.position.x+=t,a.position.y+=n,a.el.style.top=a.position.y-(e.box.top+d.y)+"px",a.el.style.left=a.position.x-(e.box.left+d.x)+"px",f=i(l,a.position)}}else l=u,f=h;var b=l.x-a.position.x,x=l.y-a.position.y;a.frontPosition={x:b,y:x},s.dataOnly||(a.ui.front.style.transform="translate("+b+"px,"+x+"px)");var w={identifier:a.identifier,position:l,force:g,pressure:t.force||t.pressure||t.webkitForce||0,distance:f,angle:{radian:y,degree:m},vector:{x:b/p,y:-x/p},raw:v,instance:a,lockX:s.lockX,lockY:s.lockY};(w=a.computeDirection(w)).angle={radian:n(180-m),degree:180-m},a.trigger("move",w),e.trigger("move "+a.id+":move",w)}else this.processOnEnd(t)},_.prototype.processOnEnd=function(t){var e=this,i=e.options,n=e.manager.getIdentifier(t),o=e.nipples.get(n),s=e.manager.removeIdentifier(o.identifier);o&&(i.dataOnly||o.hide((function(){"dynamic"===i.mode&&(o.trigger("removed",o),e.trigger("removed "+o.id+":removed",o),e.manager.trigger("removed "+o.id+":removed",o),o.destroy())})),clearInterval(e.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),e.trigger("end "+o.id+":end",o),e.ids.indexOf(o.identifier)>=0&&e.ids.splice(e.ids.indexOf(o.identifier),1),e.actives.indexOf(o)>=0&&e.actives.splice(e.actives.indexOf(o),1),/(semi|static)/.test(i.mode)?e.idles.push(o):e.nipples.indexOf(o)>=0&&e.nipples.splice(e.nipples.indexOf(o),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[s.id]=s.identifier))},_.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()},_.prototype.destroy=function(){var t=this;for(var e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()},T.prototype=new O,T.constructor=T,T.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every((function(t){return!(i=t.get(e))})),i}},T.prototype.create=function(t){return this.createCollection(t)},T.prototype.createCollection=function(t){var e=this,i=new _(e,t);return e.bindCollection(i),e.collections.push(i),i},T.prototype.bindCollection=function(t){var e,i=this,n=function(t,n){e=t.type+" "+n.id+":"+t.type,i.trigger(e,n)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)},T.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},T.prototype.unbindDocument=function(t){var e=this;Object.keys(e.ids).length&&!0!==t||(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)},T.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},T.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},T.prototype.onmove=function(t){return this.onAny("move",t),!1},T.prototype.onend=function(t){return this.onAny("end",t),!1},T.prototype.oncancel=function(t){return this.onAny("end",t),!1},T.prototype.onAny=function(t,e){var i,n=this,o="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=c(e);var s=function(t,e,i){i.ids.indexOf(e)>=0&&(i[o](t),t._found_=!0)};return m(e,(function(t){i=n.getIdentifier(t),m(n.collections,s.bind(null,t,i)),t._found_||n.removeIdentifier(i)})),!1},T.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},T.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};const E=new T,C=function(t){return E.create(t)};class S extends HTMLElement{constructor(){super(),e(this,"ws",null),e(this,"pc",null),e(this,"dc",null),e(this,"bar"),e(this,"root"),e(this,"domWsState"),e(this,"domPcState"),e(this,"domDcState"),e(this,"domGamepadState"),e(this,"gamepadIndex",null),e(this,"gamepadAxesListener",null),e(this,"checkGamepadAxes",(()=>{if(null!==this.gamepadIndex&&this.gamepadAxesListener){const t=navigator.getGamepads()[this.gamepadIndex];t&&this.gamepadAxesListener(new GamepadEvent("gamepaddisconnected",{gamepad:t}))}window.requestAnimationFrame(this.checkGamepadAxes)}));const t=document.createElement("template");this.root=this.attachShadow({mode:"closed"}),this.bar=document.createElement("div"),this.bar.style.display="flex",this.bar.style.justifyContent="space-evenly",this.root.appendChild(this.bar),this.domWsState=document.createElement("p"),this.bar.appendChild(this.domWsState),this.domPcState=document.createElement("p"),this.bar.appendChild(this.domPcState),this.domDcState=document.createElement("p"),this.bar.appendChild(this.domDcState),this.domGamepadState=document.createElement("p"),this.bar.appendChild(this.domGamepadState),this.websocketState="uninit",this.webrtcState="uninit",this.dataChannelState="uninit";const i=document.createElement("button");i.onclick=()=>{this.startWebsocket()},i.innerText="start",this.bar.appendChild(i);const n=document.createElement("button");n.innerText="切换相机模式",n.addEventListener("click",(()=>{this.handleClick()})),this.root.appendChild(n);const o=document.createElement("div");o.innerText="摇杆1";const s=document.createElement("div");s.innerText="摇杆2";const r=document.createElement("div"),a=document.createElement("div");o.appendChild(r),s.appendChild(a),this.root.appendChild(o),this.root.appendChild(s);C({zone:r,mode:"static",position:{top:"50%",left:"25%"},dynamicPage:!0,restOpacity:.6,fadeTime:200}).on("move",((t,e)=>{var i;const n={joystick1:{x:e.vector.x,y:e.vector.y}};null==(i=this.dc)||i.send(JSON.stringify(n))}));C({zone:a,mode:"static",position:{top:"50%",left:"75%"},dynamicPage:!0,restOpacity:.6,fadeTime:200}).on("move",((t,e)=>{var i;const n={joystick2:{x:e.vector.x,y:e.vector.y}};null==(i=this.dc)||i.send(JSON.stringify(n))}));const d=t.content.cloneNode(!0);this.root.appendChild(d)}set websocketState(t){this.domWsState.innerText=`websocket: ${t}`}set webrtcState(t){this.domPcState.innerText=`webrtc: ${t}`}set dataChannelState(t){this.domDcState.innerText=`dataChannel: ${t}`}get debug(){return!!this.getAttribute("debug")}get autoplay(){return!!this.getAttribute("autoplay")}get address(){return this.getAttribute("address")||""}set address(t){this.setAttribute("address",t)}startWebsocket(){console.log("websocket start"),this.ws=new WebSocket(this.address),this.ws.onopen=t=>{console.log("onopen",t),this.websocketState=t.type,this.startWebRTC()},this.ws.onclose=t=>this.websocketState=t.type,this.ws.onerror=t=>this.websocketState=t.type,this.ws.onmessage=t=>{var e;console.log("onmessage",t.data);const i=JSON.parse(t.data);if(console.log(i),"answer"===i.type){if(!this.pc)return;this.pc.setRemoteDescription(i)}else"ice"===i.type&&(null==(e=this.pc)||e.addIceCandidate(new RTCIceCandidate({sdpMid:i.label,candidate:i.candidate})))},this.startGamepadListening()}async startWebRTC(){if(console.log(this.ws),!this.ws)return;this.webrtcState="init";const t=this.ws,e=new RTCPeerConnection({iceServers:[{urls:["stun:stun.22333.fun"]},{urls:"turn:turn.22333.fun",username:"filegogo",credential:"filegogo"}]});this.pc=e,this.dc=e.createDataChannel("data",{negotiated:!0,id:0}),this.dc.onopen=t=>this.dataChannelState=t.type,this.dc.onclose=t=>this.dataChannelState=t.type,this.dc.onerror=t=>this.dataChannelState=t.type,this.dc.onmessage=t=>console.log(t.data),e.onicecandidate=i=>i.candidate?console.log(i):t.send(JSON.stringify(e.localDescription)),e.oniceconnectionstatechange=t=>this.webrtcState=e.iceConnectionState,e.addTransceiver("video",{direction:"recvonly"}),e.ontrack=t=>{if("audio"===t.track.kind){const e=document.createElement("audio");e.srcObject=t.streams[0],e.autoplay=!0,e.controls=!0,e.muted=!1,document.body.appendChild(e)}else if("video"===t.track.kind){const e=document.createElement("video");e.srcObject=t.streams[0],e.autoplay=!0,e.controls=!0,e.muted=!1,document.body.appendChild(e)}};const i=await e.createOffer();await e.setLocalDescription(i),this.startGamepadListening()}startGamepadListening(){this.gamepadIndex||(window.ongamepaddisconnected=t=>{const e=t.gamepad;this.gamepadIndex=e.index,this.domGamepadState.innerHTML="gamepad: connected",this.gamepadAxesListener=()=>{var t;if(this.gamepadIndex){const e=navigator.getGamepads()[this.gamepadIndex];if(e){const i=e.axes;if(i.length>=4){const e={joystick1:{x:i[0]||0,y:-(i[1]||0)},joystick2:{x:i[2]||0,y:-(i[3]||0)}};null==(t=this.dc)||t.send(JSON.stringify(e))}}}},window.addEventListener("gamepaddisconnected",this.gamepadAxesListener),window.requestAnimationFrame(this.checkGamepadAxes)},window.addEventListener("gamepaddisconnected",(()=>{this.gamepadIndex=null,this.domGamepadState.innerHTML="gamepad: disconnected",window.removeEventListener("gamepaddisconnected",this.gamepadAxesListener),this.gamepadAxesListener=null}))),window.requestAnimationFrame(this.checkGamepadAxes)}handleClick(){var t;null==(t=this.dc)||t.send(JSON.stringify({type:"camera_mode_toggle"}))}connectedCallback(){console.log("autoplay: ",this.autoplay),console.log(navigator.getGamepads()),this.autoplay&&(console.log("autoplay"),this.startWebsocket())}}customElements.define("joy-rtc",S)}));
//# sourceMappingURL=index.umd.js.map
